<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diary - Letters to Each Other</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="chapters.css">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&family=Patrick+Hand&display=swap" rel="stylesheet">
</head>
<body class="diary-bg">
    <div class="chapter-page">
        <div class="chapter-header">
            <h1 class="chapter-title">ğŸ“– Dil Ki Baatein</h1>
            <p class="chapter-subtitle">"Jo baatein kabhi zubaan se nahi nikli... lekin likh di hamesha ke liye âœ¨"</p>
        </div>

        <div class="diary-container">
            <div class="diary-tabs">
                <button class="diary-tab active" onclick="switchDiary('archana')">
                    ğŸ’– Archana â†’ Saloni (Letter)
                </button>
                <button class="diary-tab" onclick="switchDiary('saloni')">
                    ğŸ’– Saloni â†’ Archana (Letter)
                </button>
            </div>

            <div class="diary-book">
                <!-- Archana's Letter -->
                <div class="diary-page" id="diary-archana">
                    <div class="letter-content" id="letter-archana">
                        <h3 class="letter-heading">Dear Saloni,</h3>
                        <div class="letter-text">
                            <!-- Text will appear line by line -->
                        </div>
                    </div>
                </div>

                <!-- Saloni's Letter -->
                <div class="diary-page" id="diary-saloni" style="display: none;">
                    <div class="letter-content" id="letter-saloni">
                        <h3 class="letter-heading">Dear Archana,</h3>
                        <div class="letter-text">
                            <!-- Text will appear line by line -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="scroll-instruction" id="scroll-hint">
                âš ï¸ Dheeray scroll karo yaar... fast scrolling text ko pause kar deta hai!
            </div>
        </div>

        <div class="completion-message" id="completion-msg" style="display: none;">
            <h3>âœ¨ Diary Chapter Complete! âœ¨</h3>
            <p>Dil se nikli baatein... fr fr emotional ğŸ’Œ</p>
            <a href="../index.html" class="back-button">Memory Room pe wapas chalo ğŸ </a>
        </div>
    </div>

    <script>
        const archanaLetter = [
            "Saloni,",
            "",
            "Kabhi socha nahi tha ki school mein dekha hua woh chehra,",
            "ek din itna important ban jayega mere liye.",
            "",
            "Hum dono silent besties the lowkey... remember?",
            "Par jab baat shuru hui, tab pata chala",
            "ki kitna kuch common tha hum mein. ğŸ˜Š",
            "",
            "Tere random texts ne mere boring din chamka diye,",
            "Tere voice notes ne mujhe pagal ki tarah hasaya,",
            "Tera support mujhe sambhalta raha jab main low feel kar rahi thi.",
            "",
            "Thank you for being YOU. ğŸ’•",
            "Thank you for accepting ME, ngl.",
            "",
            "Here's to more late night talks yaar,",
            "More random plans jo kabhi complete nahi hote,",
            "More memories jo sab yaad rahein,",
            "Aur ek dosti jo last kare hamesha. No cap. âœ¨",
            "",
            "Pyaar humesha,",
            "Archana ğŸ’–"
        ];

        const saloniLetter = [
            "Archana,",
            "",
            "Honestly, mujhe pata nahi tha friendship itni easy ho sakti hai.",
            "No drama, no fakeness... just pure vibes fr fr. ğŸŒŸ",
            "",
            "Uss pehle random text se lekar ab tak,",
            "Har conversation special rahi hai.",
            "Even the silly wali. ğŸ˜‚",
            "",
            "Tu samajh jaati hai bina explanation ke,",
            "Tu support karti hai without any conditions,",
            "Tu hasati hai bina try kiye.",
            "",
            "Yeh rare hai, yk?",
            "Yeh precious hai. ğŸ’",
            "",
            "I'm so grateful hum dobara connect hue.",
            "I'm so happy tu mere life mein hai bestie.",
            "",
            "Here's to usâ€”",
            "Late nights, random thoughts ko,",
            "Group chat chaos, aur endless memories. ğŸ‰",
            "",
            "Hamesha teri friend,",
            "Saloni ğŸ’•"
        ];

        let currentDiary = 'archana';
        let lineIndex = 0;
        let isWriting = false;
        let lastScrollTime = Date.now();
        let scrollSpeed = 0;
        let bothLettersRead = { archana: false, saloni: false };

        function switchDiary(diary) {
            if (isWriting) return;

            currentDiary = diary;
            
            // Update tabs
            document.querySelectorAll('.diary-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show diary
            document.querySelectorAll('.diary-page').forEach(page => page.style.display = 'none');
            document.getElementById(`diary-${diary}`).style.display = 'block';
            document.getElementById(`diary-${diary}`).style.animation = 'pageFlip 1s ease-out';
            
            // Start writing if not already read
            if (!bothLettersRead[diary]) {
                setTimeout(() => {
                    startWriting(diary);
                }, 1000);
            }
        }

        function startWriting(diary) {
            if (isWriting) return;
            
            isWriting = true;
            lineIndex = 0;
            
            const letter = diary === 'archana' ? archanaLetter : saloniLetter;
            const container = document.querySelector(`#letter-${diary} .letter-text`);
            container.innerHTML = '';
            
            writeNextLine(letter, container, diary);
        }

        function writeNextLine(letter, container, diary) {
            if (lineIndex >= letter.length) {
                isWriting = false;
                bothLettersRead[diary] = true;
                
                // Check if both read
                if (bothLettersRead.archana && bothLettersRead.saloni) {
                    setTimeout(() => {
                        completeChapter();
                    }, 2000);
                }
                return;
            }
            
            // Check scroll speed
            const now = Date.now();
            const timeSinceLastScroll = now - lastScrollTime;
            
            if (scrollSpeed > 100 && timeSinceLastScroll < 1000) {
                // Fast scroll detected - pause
                setTimeout(() => {
                    writeNextLine(letter, container, diary);
                }, 2000);
                return;
            }
            
            const line = letter[lineIndex];
            const lineEl = document.createElement('p');
            lineEl.className = 'handwriting-line';
            lineEl.textContent = line || '\u00A0'; // nbsp for empty lines
            lineEl.style.animation = 'fadeInLine 1s ease-out';
            
            container.appendChild(lineEl);
            lineIndex++;
            
            setTimeout(() => {
                writeNextLine(letter, container, diary);
            }, 800);
        }

        function completeChapter() {
            document.getElementById('completion-msg').style.display = 'block';
            document.getElementById('completion-msg').style.animation = 'zoomIn 1s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
            
            let completed = JSON.parse(localStorage.getItem('chaptersCompleted')) || [];
            if (!completed.includes('diary')) {
                completed.push('diary');
                localStorage.setItem('chaptersCompleted', JSON.stringify(completed));
            }
        }

        // Track scroll speed
        let lastScrollPosition = 0;
        window.addEventListener('scroll', () => {
            const currentScroll = window.scrollY;
            scrollSpeed = Math.abs(currentScroll - lastScrollPosition);
            lastScrollPosition = currentScroll;
            lastScrollTime = Date.now();
        });

        window.addEventListener('load', () => {
            setTimeout(() => {
                startWriting('archana');
            }, 1000);
        });

        // Add animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInLine {
                from { opacity: 0; transform: translateX(-20px); }
                to { opacity: 1; transform: translateX(0); }
            }
            
            @keyframes pageFlip {
                0% { transform: rotateY(90deg); opacity: 0; }
                100% { transform: rotateY(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
